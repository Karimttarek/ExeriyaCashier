function getItems(t,e){$(e).find("option").remove().end(),$(e).append($("<option></option>").attr("value","").text(""));for(let a=0;a<t.length;a++)$(e).append($("<option></option>").attr("value",t[a].name).text(t[a].name))}function getItem(t,e){$.ajax({url:e,type:"GET",data:{_token:"{{csrf_token()}}",name:t},success:function(e){if(e.product.length>0){if(tax=0,null!=e.product[0].tax){arr=e.product[0].tax.split(",");for(var a=0;a<arr.length;a++)tax+=arr[a]<<0}$("#product-codeType").val(e.product[0].code_type),$("#product-itemCode").val(e.product[0].item_code),$("#product-name").val(e.product[0].name),$("#product-description").val(e.product[0].description),$("#product-uuid").val(e.product[0].uuid),$("#product-search").val(e.product[0].name),$("#product-qty").val(1),$("#product-price").val(e.product[0].price),$("#product-tax").val(tax),$("#product-discount").val(""==!e.product[0].discount?e.product[0].discount:"0"),$("#currency-type").val(e.product[0].currency_code).change();var r={first_:e.product[0].first_unit_type,second_:e.product[0].second_unit_type,third_:e.product[0].third_unit_type};$.each(r,function(t,e){(""===e||null===e)&&delete r[t]});var n=$("#product-type");n.empty(),$.each(r,function(t,e){n.append($("<option></option>").attr("value",t).text(e))}),$("#product-tax-per").val(0),$("#product-discount-per").val(0),$("#product-discAfterTax").val(0),$("#product-tax-table").val(0),$("#product-tax-table-per").val(0),CalcItemPerDisc(),CalcItemPerTax(),CalcItemNet(),CalcTotalSales(),CalcItemTotal(),$("#err-list").text(""),$("#product-search").prop("readonly",!0)}else $("#err-list").text("Cannot find item:"+t)},error:function(t){$("#err-list").text("Something went wrong !")}})}function isEmpty(t){return null==t||"string"==typeof t&&0===t.trim().length||"object"==typeof t&&0===Object.keys(t).length}document.getElementById("MoreRows").onclick=function(){document.getElementById("InvoiceItems").classList.remove("hidden")},$(document).on("click",".fa-times",function(){$("#exampleModalCenter").modal("hide")}),$(document).on("input","#product-filter , #product-filter-pur",function(){var t=$(this).val();$.ajax({url:"/product/purchase/getItems",type:"GET",data:{_token:"{{csrf_token()}}",name:t},success:function(t){getItems(t,"#product-search-pur ,#product-search"),1==t.length&&(getItem($("#product-search").val(),"/product/sales/filter"),getItem($("#product-search-pur").val(),"/product/purchase/filter"))},error:function(t){$("#err-list").text("Something went wrong !")}})}),$(document).ready(function(){$(document).on("change","#product-search-pur",function(t){getItem($("#product-search-pur").val(),"/product/purchase/filter")})}),$(document).ready(function(){$(document).on("change","#product-search",function(t){getItem($("#product-search").val(),"/product/sales/filter")})}),CalcItemNet=function(){var t=$("#product-price").val().replace(/[^0-9.]/g,""),e=$("#product-qty").val().replace(/[^0-9.]/g,""),a=$("#product-discount").val().replace(/[^0-9.]/g,""),r=$("#product-tax-table").val().replace(/[^0-9.]/g,""),n=(parseFloat(t)*parseFloat(e)-parseFloat(a)+parseFloat(r)).toFixed(2);$("#product-net").val(n),CalcItemTax(),CalcItemPerTax()},CalcTotalSales=function(){var t=$("#product-price").val().replace(/[^0-9.]/g,""),e=$("#product-qty").val().replace(/[^0-9.]/g,"");totalSales=(parseFloat(t)*parseFloat(e)).toFixed(2),$("#product-totalSales").val(totalSales)},CalcItemTotal=function(){var t=$("#product-price").val().replace(/[^0-9.]/g,""),e=$("#product-qty").val().replace(/[^0-9.]/g,""),a=0;$(".tax-row").each(function(){$("#product-tax",this).each(function(){"T4"==$(this).data("type")?a-=parseFloat($(this).val()):a+=parseFloat($(this).val())})});var r=$("#product-tax-table").val().replace(/[^0-9.]/g,""),n=$("#product-discount").val().replace(/[^0-9.]/g,""),o=$("#product-discAfterTax").val().replace(/[^0-9.]/g,"");total=$("#product-tax").length?(parseFloat(t)*parseFloat(e)+a-parseFloat(n)+parseFloat(r)).toFixed(2):(parseFloat(t)*parseFloat(e)-parseFloat(n)+parseFloat(r)).toFixed(2),total-=parseFloat(o).toFixed(2),$("#product-total").val(total)},CalcItemTax=function(){var t=$("#product-net").val().replace(/[^0-9.]/g,""),e=0;$(".tax-row").each(function(){$(".product-tax-per",this).each(function(){e=(parseFloat(t)*(parseFloat($(this).val())/100)).toFixed(2),$(this).closest(".tax-row").children(".product-tax").val(e)})})},CalcItemPerTax=function(){var t=0,e=$("#product-net").val().replace(/[^0-9.]/g,"");$(".tax-row").each(function(){$(".product-tax",this).each(function(){t=(parseFloat($(this).val())/parseFloat(e)*100).toFixed(2),$(this).closest(".tax-row").children(".product-tax-per").val(t)})})},CalcItemDisc=function(){var t=$("#product-discount-per").val().replace(/[^0-9.]/g,""),e=$("#product-price").val().replace(/[^0-9.]/g,""),a=$("#product-qty").val().replace(/[^0-9.]/g,"");discountCalc=(parseFloat(e)*parseFloat(a)*(parseFloat(t)/100)).toFixed(2),$("#product-discount").val(discountCalc),CalcItemNet()},CalcItemPerDisc=function(){var t=$("#product-discount").val().replace(/[^0-9.]/g,""),e=$("#product-price").val().replace(/[^0-9.]/g,""),a=$("#product-qty").val().replace(/[^0-9.]/g,"");isNaN(discountPerCalc=(parseFloat(t)/(parseFloat(e)*parseFloat(a))*100).toFixed(2))||""===discountPerCalc||null===discountPerCalc||$("#product-discount-per").val(discountPerCalc)},CalcItemTaxTable=function(){var t=$("#product-tax-table-per").val().replace(/[^0-9.]/g,""),e=$("#product-price").val().replace(/[^0-9.]/g,""),a=$("#product-qty").val().replace(/[^0-9.]/g,""),r=$("#product-discount").val().replace(/[^0-9.]/g,"");isNaN(taxTableCalc=((parseFloat(e)*parseFloat(a)-parseFloat(r))*(parseFloat(t)/100)).toFixed(2))||""===taxTableCalc||null===taxTableCalc||($("#product-tax-table").val(taxTableCalc),CalcItemNet())},CalcItemTaxTablePer=function(){var t=$("#product-discount").val().replace(/[^0-9.]/g,""),e=$("#product-price").val().replace(/[^0-9.]/g,""),a=$("#product-qty").val().replace(/[^0-9.]/g,""),r=$("#product-tax-table").val().replace(/[^0-9.]/g,"");isNaN(taxTablePerCalc=(parseFloat(r)/(parseFloat(e)*parseFloat(a)-parseFloat(t))*100).toFixed(2))||""===taxTablePerCalc||null===taxTablePerCalc||$("#product-tax-table-per").val(taxTablePerCalc)},$("#product-qty , #product-price").on("blur",function(){CalcItemTax(),CalcItemDisc(),CalcItemTaxTable(),CalcTotalSales(),CalcItemNet(),CalcItemTotal()}),$(" #product-tax , #product-discount").on("blur",function(){CalcItemNet(),CalcItemTotal()}),$(" #product-tax-table").on("blur",function(){CalcItemTaxTablePer(),CalcItemTotal()}),$("#product-tax-table-per").on("blur",function(){CalcItemTaxTable(),CalcItemTotal()}),$(document).on("blur","#product-tax-per",function(){CalcItemTax(),CalcItemTotal()}),$("#product-discount-per").on("blur",function(){CalcItemTaxTable(),CalcItemTaxTablePer(),CalcItemDisc(),CalcItemTotal()}),$("#product-discount").on("blur",function(){CalcItemTaxTable(),CalcItemTaxTablePer(),CalcItemPerDisc(),CalcItemTotal()}),$(document).on("blur","#product-tax",function(){CalcItemPerTax(),CalcItemTotal()}),$("#product-discAfterTax").on("blur",function(){CalcItemTotal()}),$(document).on("click","#apply",function(){if(tax=0,taxPer=0,null!=$("#product-tax").val()&&null!=$("#product-tax-per").val()){for(var t=$("input[id=product-tax]").map(function(){return this.value}).get(),e=0;e<t.length;e++)tax+=t[e]<<0;for(var a=$("input[id=product-tax-per]").map(function(){return this.value}).get(),e=0;e<a.length;e++)taxPer+=a[e]<<0}if(""!=$("#product-price").val()&&""!=$("#product-qty").val()&&""!=$("#product-tax").val()&&""!=$("#product-discount").val()&&""!=$("#product-tax-per").val()&&""!=$("#product-discount-per").val()){var r=0;let n=[-1];$(".tr-item tr input[id='num']").each(function(){n.push($(this).val())});var o="<tr id='"+Math.floor(1e21*Math.random())+Math.floor(1e21*Math.random())+"' class='bg-white border-b dark:bg-gray-800 dark:border-gray-700' >";o+="<input type='hidden' name='items["+(r=Math.max.apply(Math,n)+1)+"][number]' id='num' class='item' value='"+r+"'>",o+="<input type='hidden' name='items["+r+"][uuid]' class='item' value='"+$("#product-uuid").val()+"'>",o+="<td class='py-4' style='width:200px'><div class='row form-group' >",o+="<p><input type='text' class='col-12 text-center w-full' name='items["+r+"][code_type]' style='background: transparent ; border:none' value='"+$("#product-codeType").val()+"' readonly>",o+="<input type='text' class='col-12 text-center w-full' name='items["+r+"][item_code]' class='text-center' style='background: transparent ; border:none' value='"+$("#product-itemCode").val()+"' readonly></p></div></td>",o+="<td  class='py-4' style='width: 300px'><input type='text' name=items["+r+"][item]' class='text-center w-full' style='background: transparent ; border:none' value='"+$("#product-name").val()+"' readonly><input type='text' class='text-center w-full' name='items["+r+"][description]' style='background: transparent ; border:none' value='"+$("#product-description").val()+"' readonly></td>",o+="<td class='rw-qty py-4' style='width: 100px'><input type='number' name='items["+r+"][qty]' class='text-center w-full' id='rwqty' style='background: transparent ; border:none' value='"+$("#product-qty").val()+"' ><input type='text' class='text-center w-full' style='background: transparent ; border:none' name='items["+r+"][unit_type]' value='"+$("#product-type :selected").text()+"' ></td>",o+="<td class='rw-price py-4' style='width: 100px'><input type='number' name='items["+r+"][unitPrice]' class='text-center w-full' id='rwprice' step='1' style='background: transparent ; border:none' value='"+$("#product-price").val()+"'><input type='text' class='text-center w-full' style='background: transparent ; border:none' name='items["+r+"][currency]' value='"+$("#currency-type").val()+"' ></td>",o+="<td class='rw-disc py-4' style='width: 100px'><input type='number' name='items["+r+"][disc]' class='text-center w-full' id='rwdisc' step='1' style='background: transparent ; border:none' value='"+$("#product-discount").val()+"'><input type='number' class='text-center w-full' name='items["+r+"][discPer]' id='rwdisc-per' style='background: transparent ; border:none' value='"+$("#product-discount-per").val()+"' ></td>",o+="<td class='rw-net py-4' style='width: 120px'><input type='number' name='items["+r+"][net]' class='text-center w-full' id='rwnet' step='1' style='background: transparent ; border:none' value='"+$("#product-net").val()+"'></td>",o+="<td class='rw-tax py-4' style='width: 100px'><input type='number' name='items["+r+"][tax]' class='text-center w-full' id='rwtax' step='1' style='background: transparent ; border:none' value='"+tax+"'><input type='number' class='text-center w-full' name='items["+r+"][taxPer]' id='rwtax-per' style='background: transparent ; border:none' value='"+taxPer+"'>",$("input[id=taxType]").each(function(){o+="<input type='hidden' class='count' name='items["+r+"][taxable][0][tax_type][]' class='w-full' value='"+$(this).val()+"'>"}),$(".tax-selectSubType option:selected").each(function(){o+="<input type='hidden' name='items["+r+"][taxable][0][tax_sub_type][]' class='w-full' value='"+$(this).text()+"'>"}),$("input[id=product-tax]").each(function(){let t=0;t=$(this).val(),o+="<input type='hidden' id='txVal' name='items["+r+"][taxable][0][taxvalue][]' class='w-full' data-type='"+$("input[id=taxType]").val()+"' value='"+t+"'>"}),$("input[id=product-tax-per]").each(function(){let t=0;o+="<input type='hidden' name='items["+r+"][taxable][0][taxPervalue][]' class='w-full' value='"+(t=$(this).val())+"'>"}),o+="</td>",o+="<input type='hidden' name='items["+r+"][totalSales]' class='rw-totalSales text-center w-full' id='rw-totalSales' style='background: transparent ; border:none' value='"+$("#product-totalSales").val()+"'>",o+="<input type='hidden' name='items["+r+"][discountAfterTax]' class='rw-discountAfterTax text-center w-full' id='rw-discountAfterTax' style='background: transparent ; border:none' value='"+$("#product-discAfterTax").val()+"'>",o+="<input type='hidden' name='items["+r+"][tax_table]' class='rw-tax-table text-center w-full' id='rw-tax-table' style='background: transparent ; border:none' value='"+$("#product-tax-table").val()+"'>",o+="<input type='hidden' name='items["+r+"][tax_table_per]' class='rw-tax-table_per text-center w-full' id='rw-tax-table_per' style='background: transparent ; border:none' value='"+$("#product-tax-table-per").val()+"'>",o+="<td class='rw-total py-4' style='width: 120px'><input type='number' class='text-center w-full' name='items["+r+"][total]' id='rwtotal' style='background: transparent ; border:none' value='"+$("#product-total").val()+"' readonly></td>",$(o+="<td class=' h-print  py-4' style='width: 40px'><a href='#'><svg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='currentColor' class='trash text-center w-full bi bi-trash' viewBox='0 0 16 16'> <path d='M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z'/> <path fill-rule='evenodd' d='M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z'/> </svg></a></td></tr>").insertBefore("#MoreRows"),CalcTransTotal(),$("#reset").click(),rowsCount(),$(".tax-row").remove(),$("#err-list").text(""),saveToDraft()}else $("#err-list").text("Cannot apply the form due to some empty data")}),$("#reset").on("click",function(){$("#product-search").prop("readonly",!1),$("#err-list").text("")}),CalcTransTotal=function(){var t=0,e=0,a=0,r=0,n=0,o=0,c=0,l=$("#invDisc").val(),u=$("#invTax").val();$("table tr").each(function(){$("#rw-discountAfterTax",this).each(function(){c+=parseFloat($(this).val())}),$(".transTotalDiscAfterTax").val(c)}),$("table tr").each(function(){$("#rw-totalSales",this).each(function(){t+=parseFloat($(this).val())}),$(".totalSales").val(t)}),$("table tr").each(function(){$(".rw-tax-table",this).each(function(){r+=parseFloat($(this).val())}),$(".transTaxTable").val(r)}),$("table tr").each(function(){$("#rwnet",this).each(function(){e+=parseFloat($(this).val())}),$("#totalNet").val(e)}),$("table tr").each(function(){$("#rwtotal",this).each(function(){a+=parseFloat($(this).val()).toFixed(2)}),$(".transTotalItems").val(a)}),$("table tr").each(function(){$("#rwdisc",this).each(function(){n+=parseFloat($(this).val())}),$(".transTotalItemsDisc").val(n)}),$("table tr").each(function(){$("#txVal",this).each(function(){o+=parseFloat($(this).val()||0)}),$(".transTax").val((o+parseFloat(u)).toFixed(2))});var i=0;$("table tr").each(function(){$("#rwdisc",this).each(function(){i+=parseFloat($(this).val())}),$(".transDisc").val(parseFloat(l).toFixed(2))});var d=0;$("table tr").each(function(){$("#rwtotal",this).each(function(){d+=parseFloat($(this).val())}),$(".transTotal").val((d-parseFloat(l)+parseFloat(u)).toFixed(2))})},$("#invDisc , #invExtraDisc ,#invTax , #invExtraTax").on("input",function(){CalcTransTotal()}),$(document).on("click",".trash",function(t){t.preventDefault(),$(this).closest("tr").remove(),CalcTransTotal(),rowsCount(),$("#"+$(this).closest("tr").attr("id")).remove()}),rowsCount=function(){var t=$(".tr-item tr").length-1;$("#itemsCount").val(t>=2?t+" ITEMS":t+" ITEM")},$("#InvoiceID").text("ID: #0"+$("#InvoiceID").text()),$("#internal_id,#invoice_date,#customer_id ,#customer_name ,#customer_country ,#gov ,#cities,#customer_buldingNumber,#customer_street").on("input",function(){$("."+$(this).attr("id")).text(" "+$(this).val())}),$(document).ready(function(){$(document).on("blur","#customer_id",function(t){t.preventDefault();var e=$(this).val();$.ajax({url:"/customer/filter",type:"GET",data:{_token:"{{csrf_token()}}",id:e},success:function(t){t.length>0&&($("#customer_type").val(t[0].type),$("#customer_id").val(t[0].tax_code),$("#customer_name").val(t[0].name),$("#customer_country ").val(t[0].country),$("#gov").val(t[0].gov),$("#cities").val(t[0].city),$("#customer_building_number").val(t[0].building_number),$("#customer_street").val(t[0].street),$(".customer_id").text(t[0].tax_code),$(".customer_name").text(t[0].name),$(".customer_country ").text(t[0].country+" "),$(".gov").text(t[0].gov+" "),$(".cities").text(t[0].city),$(".customer_building_number").text(t[0].building_number),$(".customer_street").text(t[0].street))},error:function(t){}})})}),$("#tax-select").on("change",function(){this.name;var t=this.value;$.ajax({url:"/get/taxes/subTypes",type:"GET",data:{_token:"{{csrf_token()}}",taxType:t},success:function(e){if(e.length>0){var a='<div class="grid lg:grid-cols-5 gap-1 mt-2 tax-row">',r=0;$(".count").length&&(r=(parseInt($(".count").val())+1).toFixed(0)),a+='<div class="grid grid-cols-2"><input type="hidden" class="count" value="'+r+'">',a+='<input type="text" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-sm focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" id="taxType" name="tax_code" value="'+t+'" readonly>',a+='<select name="tax" id="tax-selectSubType" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-sm focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500 tax-selectSubType">';for(let n=0;n<e.length;n++){let o=e[n].Code;a+='<option value="'+o+'">'+o,a+="</option>"}a+="</select></div>",a+='<input type="number" class="bg-white text-gray-900 border-gray-300 text-sm rounded-sm block w-full p-2.5 dark:bg-gray-700 dark:text-white product-tax" id="product-tax" data-type="'+t+'" value="0" min="0">',a+='<p class="p-2.5 bg-gray-50" for="product-tax-per">%</p>',a+='<input type="number" class="bg-white text-gray-900 border-gray-300 text-sm rounded-sm block w-full p-2.5 dark:bg-gray-700 dark:text-white product-tax-per" id="product-tax-per" data-type="'+t+'" value="0" min="0">',a+='<p class="p-2.5 cursor-pointer" > <svg id="remove-tax" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16"> <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/> <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/> </svg></p></div>',$(".tax-select").append(a),$("#tax-select").val("Select Tax")}},error:function(t){}})}),$(document).on("click","#remove-tax",function(t){this.closest("div").remove(),CalcItemTotal()});let nextRequest;$(document).on("click",".rounded-md.text-sm.font-medium.bg-white.text-primary-600",function(){location.href=nextRequest}),$(document).on("click",".relative.leading-8.m-0.pl-6",function(t){null!==document.querySelector(".bg-white.border-b")&&(t.preventDefault(),nextRequest=$(this).closest("a").attr("href"),window.$wireui.confirmNotification({title:"You are about to lose data are you sure you want to leave?",description:"Are you sure you want to leave?",icon:"question",accept:{label:"Yes, leave",method:"leave",params:"Leaved"},reject:{label:"No, cancel",method:"cancel"}}))}),$(document).on("click","a.flex-shrink-0.flex.items-center.gap-2.p-1.transition-colors.rounded-md.overflow-hidden.text-gray-800",function(t){null!==document.querySelector(".bg-white.border-b")&&(t.preventDefault(),nextRequest=$(this).closest("a").attr("href"),window.$wireui.confirmNotification({title:"You are about to lose data are you sure you want to leave?",description:"Are you sure you want to leave?",icon:"question",accept:{label:"Yes, leave",method:"leave",params:"Leaved"},reject:{label:"No, cancel",method:"cancel"}}))}),$(document).ready(function(){document.onkeydown=function(t){27==t.keyCode&&document.getElementById("InvoiceItems").classList.add("hidden")}}),$(document).on("change","#product-type",function(t){var e=$("#product-name").val(),a=$(this).val(),r="";r=-1!=window.location.href.indexOf("purchase")?"/product/pur/type/filter":"/product/sales/type/filter",$.ajax({url:r,type:"GET",data:{_token:"{{csrf_token()}}",name:e,type:a},success:function(t){$("#product-price").val(Object.values(t[0])[0]),CalcItemTax(),CalcItemDisc(),CalcItemTaxTable(),CalcTotalSales(),CalcItemNet(),CalcItemTotal()},error:function(t){$("#err-list").text("Something went wrong !")}})});
